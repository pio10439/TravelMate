<!DOCTYPE html>
<html lang="" data-lang="">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta
      name="description"
      content="Offline mode – TravelMate works without internet"
    />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="author" content="Piotr Owczarzak" />
    <meta name="theme-color" content="#3498db" />
    <meta name="apple-mobile-web-app-status-bar-style" content="default" />
    <meta name="apple-mobile-web-app-title" content="TravelMate" />

    <title data-key="offlineTitle">TravelMate - Offline</title>

    <link rel="stylesheet" href="/css/style.css" />
    <link rel="manifest" href="manifest.webmanifest" />
    <link rel="icon" href="images/favicon.png" type="image/png" />

    <link rel="preconnect" href="https://api.weatherapi.com" />
    <link rel="preconnect" href="https://tile.openstreetmap.org" />

    <script src="/js/utils.js" defer crossorigin="anonymous"></script>
    <script
      src="/translations/nav-translation.js"
      defer
      crossorigin="anonymous"
    ></script>
    <script
      src="/translations/translation.js"
      defer
      crossorigin="anonymous"
    ></script>
    <script src="/js/toast.js" defer crossorigin="anonymous"></script>
    <script>
      document.addEventListener('DOMContentLoaded', () => {
        const savedLang = localStorage.getItem('language') || 'English';

        if (typeof loadTranslations === 'function') {
          loadTranslations(savedLang);
        }

        document.querySelectorAll('[data-key]').forEach(el => {
          const key = el.getAttribute('data-key');
          const translated = getTranslation(key);

          if (el.tagName === 'TITLE') {
            document.title = translated;
          } else {
            el.textContent = translated;
          }
        });

        if (localStorage.getItem('darkTheme') === 'true') {
          document.body.classList.add('dark-theme');
        }
      });
    </script>
    <script>
      document
        .getElementById('back-to-app')
        ?.addEventListener('click', async () => {
          try {
            const allClients = await clients.matchAll({
              includeUncontrolled: true,
              type: 'window',
            });
            if (allClients.length > 0) {
              allClients[0].focus();
            } else {
              clients.openWindow('/index.html');
            }
          } catch (err) {
            location.href = '/index.html';
          }
        });
    </script>
  </head>
  <body>
    <div class="offline-page" role="region" aria-label="Offline-status">
      <div class="offline-icon">No Internet Connection</div>

      <h1 data-key="offlineHeading">You are offline</h1>

      <p data-key="offlineMessage">
        Your app works fully offline. All saved trips, map and settings are
        available.
      </p>

      <button type="button" class="btn-home" id="back-to-app" role="button">
        <span data-key="backToApp">Wróć do aplikacji</span>
      </button>
    </div>
    <div id="toast-container" role="alert" aria-live="polite"></div>
  </body>
</html>
